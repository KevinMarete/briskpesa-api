server {
    listen 80;
    server_name {{ server_name }};
    rewrite ^/(.*) https://{{ server_name }}/$1 permanent;
}

server {
        listen 443 ssl;
        server_name {{ server_name }} ssl;
        charset utf-8;

        ssl on;
        ssl_certificate /home/andati/.ssh/{{ server_name }}.chained.crt;
        ssl_certificate_key /home/andati/.ssh/{{ server_name }}.key;

        ssl_session_timeout 5m;

        ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers "HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES";
        ssl_prefer_server_ciphers on;
        
        location /static {
			alias {{ static_root }};
		}

        location / {
	        proxy_pass http://127.0.0.1:8000;
	        proxy_set_header X-Forwarded-Host $server_name;
	        proxy_set_header X-Real-IP $remote_addr;
	        add_header P3P 'CP="ALL DSP COR PSAa PSDa OUR NOR ONL UNI COM NAV"';
        }
}